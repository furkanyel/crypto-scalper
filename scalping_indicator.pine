//@version=5
indicator("5M Crypto Scalping Indicator", overlay=true, max_bars_back=500)

// ================================================================================
// INPUT SETTINGS
// ================================================================================

// RSI Settings
rsiLength = input.int(14, "RSI Period", minval=1, group="RSI Settings")
rsiOverbought = input.int(70, "RSI Overbought Level", minval=50, maxval=100, group="RSI Settings")
rsiOversold = input.int(30, "RSI Oversold Level", minval=0, maxval=50, group="RSI Settings")

// EMA Settings
emaFastLength = input.int(9, "Fast EMA Period", minval=1, group="EMA Settings")
emaSlowLength = input.int(21, "Slow EMA Period", minval=1, group="EMA Settings")

// Bollinger Bands Settings
bbLength = input.int(20, "Bollinger Bands Period", minval=1, group="Bollinger Bands Settings")
bbStdDev = input.float(2.0, "Bollinger Bands Std Dev", minval=0.1, step=0.1, group="Bollinger Bands Settings")

// Volume Settings
volumeMaLength = input.int(20, "Volume MA Period", minval=1, group="Volume Settings")

// Display Settings
showEMAs = input.bool(true, "Show EMAs", group="Display Settings")
showBollingerBands = input.bool(true, "Show Bollinger Bands", group="Display Settings")
showBackgroundColor = input.bool(false, "Show Background Color on Signals", group="Display Settings")

// Color Settings
emaFastColor = input.color(color.new(color.blue, 0), "Fast EMA Color", group="Color Settings")
emaSlowColor = input.color(color.new(color.orange, 0), "Slow EMA Color", group="Color Settings")
bbUpperColor = input.color(color.new(color.red, 70), "BB Upper Band Color", group="Color Settings")
bbLowerColor = input.color(color.new(color.green, 70), "BB Lower Band Color", group="Color Settings")
bbMidColor = input.color(color.new(color.gray, 0), "BB Middle Band Color", group="Color Settings")
buySignalColor = input.color(color.new(color.green, 0), "Buy Signal Color", group="Color Settings")
sellSignalColor = input.color(color.new(color.red, 0), "Sell Signal Color", group="Color Settings")

// ================================================================================
// INDICATOR CALCULATIONS
// ================================================================================

// RSI Calculation
rsiValue = ta.rsi(close, rsiLength)

// EMA Calculations
emaFast = ta.ema(close, emaFastLength)
emaSlow = ta.ema(close, emaSlowLength)

// Bollinger Bands Calculation
[bbMiddle, bbUpper, bbLower] = ta.bb(close, bbLength, bbStdDev)

// Volume Analysis
volumeMa = ta.sma(volume, volumeMaLength)
volumeAboveAverage = volume > volumeMa

// ================================================================================
// SIGNAL CONDITIONS
// ================================================================================

// RSI Conditions (using crossover/crossunder to avoid repainting)
rsiCrossAboveOversold = ta.crossover(rsiValue, rsiOversold)
rsiCrossBelowOverbought = ta.crossunder(rsiValue, rsiOverbought)

// EMA Crossover Conditions
emaBullishCross = ta.crossover(emaFast, emaSlow)
emaBearishCross = ta.crossunder(emaFast, emaSlow)

// Bollinger Bands Conditions
priceTouchLowerBB = low <= bbLower
priceTouchUpperBB = high >= bbUpper

// Buy Signal - All conditions must be true
buySignal = rsiCrossAboveOversold and emaBullishCross and priceTouchLowerBB and volumeAboveAverage

// Sell Signal - All conditions must be true
sellSignal = rsiCrossBelowOverbought and emaBearishCross and priceTouchUpperBB and volumeAboveAverage

// ================================================================================
// PLOTTING
// ================================================================================

// Plot EMAs
plot(showEMAs ? emaFast : na, "Fast EMA", color=emaFastColor, linewidth=2)
plot(showEMAs ? emaSlow : na, "Slow EMA", color=emaSlowColor, linewidth=2)

// Plot Bollinger Bands
bbUpperPlot = plot(showBollingerBands ? bbUpper : na, "BB Upper", color=bbUpperColor, linewidth=1)
bbLowerPlot = plot(showBollingerBands ? bbLower : na, "BB Lower", color=bbLowerColor, linewidth=1)
bbMiddlePlot = plot(showBollingerBands ? bbMiddle : na, "BB Middle", color=bbMidColor, linewidth=1, style=plot.style_circles)

// Fill Bollinger Bands
fill(bbUpperPlot, bbMiddlePlot, color=color.new(color.red, 95), title="BB Upper Fill")
fill(bbMiddlePlot, bbLowerPlot, color=color.new(color.green, 95), title="BB Lower Fill")

// Plot Buy/Sell Signals with Arrows
plotshape(buySignal, title="Buy Signal", location=location.belowbar, color=buySignalColor, style=shape.triangleup, size=size.normal, text="BUY")
plotshape(sellSignal, title="Sell Signal", location=location.abovebar, color=sellSignalColor, style=shape.triangledown, size=size.normal, text="SELL")

// Background Color Highlighting
bgColor = showBackgroundColor ? (buySignal ? color.new(color.green, 90) : sellSignal ? color.new(color.red, 90) : na) : na
bgcolor(bgColor, title="Signal Background")

// ================================================================================
// ALERTS
// ================================================================================

// Alert Conditions
alertcondition(buySignal, title="Buy Signal Alert", message="ðŸŸ¢ BUY SIGNAL: RSI crossed above {{rsiOversold}}, EMA bullish crossover, price touched lower BB, volume above average. Time: {{time}}, Price: {{close}}")
alertcondition(sellSignal, title="Sell Signal Alert", message="ðŸ”´ SELL SIGNAL: RSI crossed below {{rsiOverbought}}, EMA bearish crossover, price touched upper BB, volume above average. Time: {{time}}, Price: {{close}}")

// Combined alert for any signal
alertcondition(buySignal or sellSignal, title="Any Signal Alert", message="âš ï¸ TRADING SIGNAL DETECTED - Check chart for details. Time: {{time}}, Price: {{close}}")

// ================================================================================
// INFORMATION TABLE (Optional - displays current indicator values)
// ================================================================================

// Create info table in top right corner
var table infoTable = table.new(position.top_right, 2, 6, bgcolor=color.new(color.black, 85), border_width=1, border_color=color.gray)

if barstate.islast
    table.cell(infoTable, 0, 0, "Indicator", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 0, "Value", text_color=color.white, text_size=size.small)
    
    table.cell(infoTable, 0, 1, "RSI", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 1, str.tostring(rsiValue, "#.##"), text_color=rsiValue > rsiOverbought ? color.red : rsiValue < rsiOversold ? color.green : color.white, text_size=size.small)
    
    table.cell(infoTable, 0, 2, "Fast EMA", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 2, str.tostring(emaFast, "#.##"), text_color=emaFastColor, text_size=size.small)
    
    table.cell(infoTable, 0, 3, "Slow EMA", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 3, str.tostring(emaSlow, "#.##"), text_color=emaSlowColor, text_size=size.small)
    
    table.cell(infoTable, 0, 4, "Volume vs MA", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 4, volumeAboveAverage ? "Above âœ“" : "Below âœ—", text_color=volumeAboveAverage ? color.green : color.red, text_size=size.small)
    
    table.cell(infoTable, 0, 5, "Trend", text_color=color.white, text_size=size.small)
    table.cell(infoTable, 1, 5, emaFast > emaSlow ? "Bullish â†‘" : "Bearish â†“", text_color=emaFast > emaSlow ? color.green : color.red, text_size=size.small)

// ================================================================================
// END OF INDICATOR
// ================================================================================
